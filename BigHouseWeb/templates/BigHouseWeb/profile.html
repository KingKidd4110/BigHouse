<!-- templates/profile.html -->
{% extends 'BigHouseWeb/base.html' %}
{% load static %}


{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row gap-8">
        <!-- Profile Card -->
        <div class="w-full md:w-1/3">
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 theme-transition">
                <div class="flex flex-col items-center mb-6">
                    <div class="w-24 h-24 rounded-full bg-gray-200 dark:bg-slate-700 mb-4 overflow-hidden">
                        {% if user_profile.profile_picture %}
                            <img src="{{ user_profile.profile_picture.url }}" alt="Profile Picture" class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center">
                                <i class="fas fa-user text-4xl text-gray-400"></i>
                            </div>
                        {% endif %}
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">{{ user.username }}</h2>
                    <p class="text-gray-600 dark:text-slate-300 capitalize">{{ user_profile.user_type }}</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 dark:text-slate-400 mb-1">Email</h3>
                        <p class="text-gray-800 dark:text-white">{{ user.email }}</p>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 dark:text-slate-400 mb-1">Phone</h3>
                        <p class="text-gray-800 dark:text-white">
                            {% if user_profile.phone_number %}
                                {{ user_profile.phone_number }}
                            {% else %}
                                Not provided
                            {% endif %}
                        </p>
                    </div>
                    
                    {% if house %}
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 dark:text-slate-400 mb-1">Building</h3>
                        <p class="text-gray-800 dark:text-white">{{ house.building.name }}</p>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 dark:text-slate-400 mb-1">House Number</h3>
                        <p class="text-gray-800 dark:text-white">{{ house.house_number }}</p>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 dark:text-slate-400 mb-1">Rent Amount</h3>
                        <p class="text-gray-800 dark:text-white">${{ house.rent_amount }}/month</p>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Edit Profile Button -->
                <label for="edit-profile-modal" class="btn btn-primary btn-block mt-6">
                    <i class="fas fa-edit mr-2"></i>Edit Profile
                </label>
            </div>
            
            <!-- Rent Status Card -->
            {% if user_profile.user_type == 'tenant' and house %}
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 mt-6 theme-transition">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Rent Status</h2>
                
                <div class="flex items-center mb-4">
                    {% if rent_status == 'paid' %}
                    <div class="badge badge-success gap-2">
                        <i class="fas fa-check-circle"></i> Paid
                    </div>
                    {% elif rent_status == 'overdue' %}
                    <div class="badge badge-error gap-2">
                        <i class="fas fa-exclamation-circle"></i> Overdue
                    </div>
                    {% elif rent_status == 'due_soon' %}
                    <div class="badge badge-warning gap-2">
                        <i class="fas fa-clock"></i> Due Soon
                    </div>
                    {% else %}
                    <div class="badge badge-ghost gap-2">
                        <i class="fas fa-question-circle"></i> Unknown
                    </div>
                    {% endif %}
                </div>
                
                <a href="{% url 'rent_status' %}" class="btn btn-outline btn-block dark:border-slate-400 dark:text-white">
                    <i class="fas fa-credit-card mr-2"></i>Check Payments or Pay
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Main Content -->
        <div class="w-full md:w-2/3">
            <!-- Management Alerts -->
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 mb-6 theme-transition">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Management Alerts</h2>
                
                {% if alerts %}
                <div class="space-y-4">
                    {% for alert in alerts %}
                    <div class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500 p-4 rounded">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200">{{ alert.title }}</h3>
                        <p class="text-blue-700 dark:text-blue-300 mt-1">{{ alert.message }}</p>
                        <p class="text-xs text-blue-600 dark:text-blue-400 mt-2">{{ alert.created_at }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-600 dark:text-slate-400">No alerts at this time.</p>
                {% endif %}
            </div>
            
            <!-- Recent Payments (for tenants) -->
            {% if user_profile.user_type == 'tenant' and house %}
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6 theme-transition">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Recent Payments</h2>
                
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th>Date Paid</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Due Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in rent_payments %}
                            <tr>
                                <td>{% if payment.paid_date %}{{ payment.paid_date }}{% else %}â€”{% endif %}</td>
                                <td>${{ payment.amount }}</td>
                                <td>
                                    <span class="badge {% if payment.status == 'paid' %}badge-success{% elif payment.status == 'due' %}badge-warning{% else %}badge-error{% endif %}">
                                        {{ payment.status|title }}
                                    </span>
                                </td>
                                <td>{{ payment.due_date }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No payment records found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 text-center">
                    <a href="{% url 'rent_status' %}" class="link link-primary">View all payments</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<input type="checkbox" id="edit-profile-modal" class="modal-toggle" />
<div class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg">Edit Profile</h3>
        
        <form method="POST" action="{% url 'profile' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="update_profile" value="true">
            
            <div class="form-control mt-4">
                <label class="label">
                    <span class="label-text">Profile Picture</span>
                </label>
                <input type="file" name="profile_picture" class="file-input file-input-bordered w-full">
            </div>
            
            <div class="form-control mt-4">
                <label class="label">
                    <span class="label-text">Phone Number</span>
                </label>
                <input type="text" name="phone_number" value="{{ form.phone_number.value|default:'' }}" placeholder="Your phone number" class="input input-bordered w-full">
            </div>
            
            <div class="modal-action">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <label for="edit-profile-modal" class="btn">Cancel</label>
            </div>
        </form>
    </div>
</div>
{% endblock %}
